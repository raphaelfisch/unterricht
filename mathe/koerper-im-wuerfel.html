<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Körper im Würfel</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: #fff;
            color: #000;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        h1 { font-size: 1.2rem; font-weight: 500; margin-bottom: 20px; text-align: center; }
        
        .task-section {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 16px;
        }
        .view-box { text-align: center; }
        .view-box label { display: block; font-size: 0.85rem; color: #666; margin-bottom: 6px; }
        .view-box canvas { border: 1px solid #ccc; background: #fff; }
        
        .new-task-btn {
            display: block;
            width: 100%;
            max-width: 400px;
            margin: 0 auto 16px;
            padding: 10px 20px;
            font-family: inherit;
            font-size: 0.95rem;
            background: #2563eb;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .new-task-btn:hover { background: #1d4ed8; }
        
        .workspace { width: 100%; position: relative; }
        #canvas3d { 
            border: 1px solid #ccc; 
            cursor: grab; 
            display: block; 
            background: #fff;
        }
        #canvas3d:active { cursor: grabbing; }
        
        .controls { 
            margin-top: 12px; 
            display: flex; 
            gap: 8px; 
            flex-wrap: wrap;
            justify-content: center;
        }
        button {
            font-family: inherit; font-size: 0.85rem; padding: 6px 14px;
            border: 1px solid #ccc; background: #fff; cursor: pointer; border-radius: 3px;
        }
        button:hover { background: #f5f5f5; }
        button.active { background: #000; color: #fff; border-color: #000; }
        button.success { background: #16a34a; color: #fff; border-color: #16a34a; }
        button.success:hover { background: #15803d; }
        
        .status { 
            margin-top: 12px; 
            font-size: 0.85rem; 
            color: #666; 
            text-align: center;
        }
        .divider { width: 1px; background: #ddd; margin: 0 4px; }
        .feedback { 
            margin-top: 8px; 
            padding: 8px 12px; 
            border-radius: 4px; 
            font-size: 0.85rem; 
            display: none;
            text-align: center;
        }
        .feedback.correct { display: block; background: #dcfce7; color: #166534; border: 1px solid #86efac; }
        .feedback.incorrect { display: block; background: #fef2f2; color: #991b1b; border: 1px solid #fca5a5; }
        
        /* Mobile responsive */
        @media (max-width: 480px) {
            body { padding: 10px; }
            h1 { font-size: 1rem; margin-bottom: 12px; }
            
            .task-section {
                gap: 8px;
                margin-bottom: 10px;
            }
            .view-box label { font-size: 0.7rem; margin-bottom: 3px; }
            .view-box canvas { 
                width: 90px !important; 
                height: 90px !important; 
            }
            
            .new-task-btn {
                padding: 8px 16px;
                font-size: 0.85rem;
                margin-bottom: 10px;
            }
            
            .controls {
                gap: 5px;
                margin-top: 8px;
            }
            button {
                font-size: 0.75rem;
                padding: 5px 8px;
            }
            
            .status {
                font-size: 0.75rem;
                margin-top: 8px;
            }
            .feedback {
                font-size: 0.75rem;
                padding: 6px 10px;
            }
        }
        
        /* Very small screens */
        @media (max-width: 360px) {
            .view-box canvas { 
                width: 75px !important; 
                height: 75px !important; 
            }
            button {
                font-size: 0.7rem;
                padding: 4px 6px;
            }
        }
    </style>
</head>
<body>
    <h1>Körper im Würfel</h1>
    
    <div class="task-section">
        <div class="view-box">
            <label>von vorne</label>
            <canvas id="viewFront" width="120" height="120"></canvas>
        </div>
        <div class="view-box">
            <label>von rechts</label>
            <canvas id="viewRight" width="120" height="120"></canvas>
        </div>
        <div class="view-box">
            <label>von oben</label>
            <canvas id="viewTop" width="120" height="120"></canvas>
        </div>
    </div>
    
    <button class="new-task-btn" onclick="newTask()">Neue Aufgabe</button>
    
    <div class="workspace">
        <canvas id="canvas3d" width="600" height="450"></canvas>
        <div class="controls">
            <button onclick="setView('front')">von vorne</button>
            <button onclick="setView('right')">von rechts</button>
            <button onclick="setView('top')">von oben</button>
            <button onclick="setView('iso')" class="active" id="btnIso">Schrägbild</button>
        </div>
        <div class="controls">
            <button onclick="clearAll()">Löschen</button>
            <button class="success" onclick="checkSolution()">✓ Prüfen</button>
            <button onclick="showSolution()">Lösung</button>
        </div>
        <div class="status">
            <span id="statusText">Klicke zwei Punkte um eine Kante zu zeichnen</span>
            · <span id="edgeCount">0</span> Kanten
        </div>
        <div class="feedback" id="feedback"></div>
    </div>

    <script>
        let scene, camera, renderer;
        let edges = [];
        let selectedPoint = null;
        let pointMeshes = [];
        let hitBoxes = [];
        let edgeLines = [];
        let cubeEdgeLines = [];
        let faceMeshes = [];
        let raycaster, mouse;
        let isRotating = false;
        let previousMousePosition = { x: 0, y: 0 };
        let cubeGroup;
        let currentShape = null;
        
        // Camera orbit - Standard isometric like reference image
        // Looking from front-right-top towards center
        let cameraTheta = Math.PI / 5;    // slightly less than 45° horizontal
        let cameraPhi = Math.PI * 0.38;   // about 68° from top (more frontal view)
        const center = new THREE.Vector3(1, 1, 1);
        const cameraDistance = 4;
        
        const GRID_SIZE = 2;
        
        // Cube edge definitions with face information
        const cubeEdgeDefinitions = [
            // Bottom face edges (y=0)
            { from: [0,0,0], to: [2,0,0], faces: ['y0', 'z0'] },
            { from: [2,0,0], to: [2,0,2], faces: ['y0', 'x2'] },
            { from: [2,0,2], to: [0,0,2], faces: ['y0', 'z2'] },
            { from: [0,0,2], to: [0,0,0], faces: ['y0', 'x0'] },
            // Top face edges (y=2)
            { from: [0,2,0], to: [2,2,0], faces: ['y2', 'z0'] },
            { from: [2,2,0], to: [2,2,2], faces: ['y2', 'x2'] },
            { from: [2,2,2], to: [0,2,2], faces: ['y2', 'z2'] },
            { from: [0,2,2], to: [0,2,0], faces: ['y2', 'x0'] },
            // Vertical edges
            { from: [0,0,0], to: [0,2,0], faces: ['x0', 'z0'] },
            { from: [2,0,0], to: [2,2,0], faces: ['x2', 'z0'] },
            { from: [2,0,2], to: [2,2,2], faces: ['x2', 'z2'] },
            { from: [0,0,2], to: [0,2,2], faces: ['x0', 'z2'] }
        ];
        
        const shapes = {
            // ==================== WÜRFEL ====================
            wuerfel_gross: {
                name: "Würfel 2×2×2",
                edges: [
                    [[0,0,0],[2,0,0]], [[2,0,0],[2,0,2]], [[2,0,2],[0,0,2]], [[0,0,2],[0,0,0]],
                    [[0,2,0],[2,2,0]], [[2,2,0],[2,2,2]], [[2,2,2],[0,2,2]], [[0,2,2],[0,2,0]],
                    [[0,0,0],[0,2,0]], [[2,0,0],[2,2,0]], [[2,0,2],[2,2,2]], [[0,0,2],[0,2,2]]
                ],
                faces: [
                    [[0,0,0], [2,0,0], [2,2,0], [0,2,0]], [[0,0,2], [2,0,2], [2,2,2], [0,2,2]],
                    [[0,0,0], [0,0,2], [0,2,2], [0,2,0]], [[2,0,0], [2,0,2], [2,2,2], [2,2,0]],
                    [[0,0,0], [2,0,0], [2,0,2], [0,0,2]], [[0,2,0], [2,2,0], [2,2,2], [0,2,2]]
                ]
            },
            wuerfel_klein_000: {
                name: "Würfel 1×1×1",
                edges: [
                    [[0,0,0],[1,0,0]], [[1,0,0],[1,0,1]], [[1,0,1],[0,0,1]], [[0,0,1],[0,0,0]],
                    [[0,1,0],[1,1,0]], [[1,1,0],[1,1,1]], [[1,1,1],[0,1,1]], [[0,1,1],[0,1,0]],
                    [[0,0,0],[0,1,0]], [[1,0,0],[1,1,0]], [[1,0,1],[1,1,1]], [[0,0,1],[0,1,1]]
                ],
                faces: [
                    [[0,0,0], [1,0,0], [1,1,0], [0,1,0]], [[0,0,1], [1,0,1], [1,1,1], [0,1,1]],
                    [[0,0,0], [0,0,1], [0,1,1], [0,1,0]], [[1,0,0], [1,0,1], [1,1,1], [1,1,0]],
                    [[0,0,0], [1,0,0], [1,0,1], [0,0,1]], [[0,1,0], [1,1,0], [1,1,1], [0,1,1]]
                ]
            },
            wuerfel_klein_100: {
                name: "Würfel 1×1×1",
                edges: [
                    [[1,0,0],[2,0,0]], [[2,0,0],[2,0,1]], [[2,0,1],[1,0,1]], [[1,0,1],[1,0,0]],
                    [[1,1,0],[2,1,0]], [[2,1,0],[2,1,1]], [[2,1,1],[1,1,1]], [[1,1,1],[1,1,0]],
                    [[1,0,0],[1,1,0]], [[2,0,0],[2,1,0]], [[2,0,1],[2,1,1]], [[1,0,1],[1,1,1]]
                ],
                faces: [
                    [[1,0,0], [2,0,0], [2,1,0], [1,1,0]], [[1,0,1], [2,0,1], [2,1,1], [1,1,1]],
                    [[1,0,0], [1,0,1], [1,1,1], [1,1,0]], [[2,0,0], [2,0,1], [2,1,1], [2,1,0]],
                    [[1,0,0], [2,0,0], [2,0,1], [1,0,1]], [[1,1,0], [2,1,0], [2,1,1], [1,1,1]]
                ]
            },
            wuerfel_klein_111: {
                name: "Würfel 1×1×1",
                edges: [
                    [[1,1,1],[2,1,1]], [[2,1,1],[2,1,2]], [[2,1,2],[1,1,2]], [[1,1,2],[1,1,1]],
                    [[1,2,1],[2,2,1]], [[2,2,1],[2,2,2]], [[2,2,2],[1,2,2]], [[1,2,2],[1,2,1]],
                    [[1,1,1],[1,2,1]], [[2,1,1],[2,2,1]], [[2,1,2],[2,2,2]], [[1,1,2],[1,2,2]]
                ],
                faces: [
                    [[1,1,1], [2,1,1], [2,2,1], [1,2,1]], [[1,1,2], [2,1,2], [2,2,2], [1,2,2]],
                    [[1,1,1], [1,1,2], [1,2,2], [1,2,1]], [[2,1,1], [2,1,2], [2,2,2], [2,2,1]],
                    [[1,1,1], [2,1,1], [2,1,2], [1,1,2]], [[1,2,1], [2,2,1], [2,2,2], [1,2,2]]
                ]
            },
            wuerfel_klein_011: {
                name: "Würfel 1×1×1",
                edges: [
                    [[0,1,1],[1,1,1]], [[1,1,1],[1,1,2]], [[1,1,2],[0,1,2]], [[0,1,2],[0,1,1]],
                    [[0,2,1],[1,2,1]], [[1,2,1],[1,2,2]], [[1,2,2],[0,2,2]], [[0,2,2],[0,2,1]],
                    [[0,1,1],[0,2,1]], [[1,1,1],[1,2,1]], [[1,1,2],[1,2,2]], [[0,1,2],[0,2,2]]
                ],
                faces: [
                    [[0,1,1], [1,1,1], [1,2,1], [0,2,1]], [[0,1,2], [1,1,2], [1,2,2], [0,2,2]],
                    [[0,1,1], [0,1,2], [0,2,2], [0,2,1]], [[1,1,1], [1,1,2], [1,2,2], [1,2,1]],
                    [[0,1,1], [1,1,1], [1,1,2], [0,1,2]], [[0,2,1], [1,2,1], [1,2,2], [0,2,2]]
                ]
            },
            
            // ==================== QUADER ====================
            quader_2x2x1: {
                name: "Quader 2×2×1",
                edges: [
                    [[0,0,0],[2,0,0]], [[2,0,0],[2,0,2]], [[2,0,2],[0,0,2]], [[0,0,2],[0,0,0]],
                    [[0,1,0],[2,1,0]], [[2,1,0],[2,1,2]], [[2,1,2],[0,1,2]], [[0,1,2],[0,1,0]],
                    [[0,0,0],[0,1,0]], [[2,0,0],[2,1,0]], [[2,0,2],[2,1,2]], [[0,0,2],[0,1,2]]
                ],
                faces: [
                    [[0,0,0], [2,0,0], [2,1,0], [0,1,0]], [[0,0,2], [2,0,2], [2,1,2], [0,1,2]],
                    [[0,0,0], [0,0,2], [0,1,2], [0,1,0]], [[2,0,0], [2,0,2], [2,1,2], [2,1,0]],
                    [[0,0,0], [2,0,0], [2,0,2], [0,0,2]], [[0,1,0], [2,1,0], [2,1,2], [0,1,2]]
                ]
            },
            quader_2x1x2: {
                name: "Quader 2×1×2",
                edges: [
                    [[0,0,0],[2,0,0]], [[2,0,0],[2,0,1]], [[2,0,1],[0,0,1]], [[0,0,1],[0,0,0]],
                    [[0,2,0],[2,2,0]], [[2,2,0],[2,2,1]], [[2,2,1],[0,2,1]], [[0,2,1],[0,2,0]],
                    [[0,0,0],[0,2,0]], [[2,0,0],[2,2,0]], [[2,0,1],[2,2,1]], [[0,0,1],[0,2,1]]
                ],
                faces: [
                    [[0,0,0], [2,0,0], [2,2,0], [0,2,0]], [[0,0,1], [2,0,1], [2,2,1], [0,2,1]],
                    [[0,0,0], [0,0,1], [0,2,1], [0,2,0]], [[2,0,0], [2,0,1], [2,2,1], [2,2,0]],
                    [[0,0,0], [2,0,0], [2,0,1], [0,0,1]], [[0,2,0], [2,2,0], [2,2,1], [0,2,1]]
                ]
            },
            quader_1x2x2: {
                name: "Quader 1×2×2",
                edges: [
                    [[0,0,0],[1,0,0]], [[1,0,0],[1,0,2]], [[1,0,2],[0,0,2]], [[0,0,2],[0,0,0]],
                    [[0,2,0],[1,2,0]], [[1,2,0],[1,2,2]], [[1,2,2],[0,2,2]], [[0,2,2],[0,2,0]],
                    [[0,0,0],[0,2,0]], [[1,0,0],[1,2,0]], [[1,0,2],[1,2,2]], [[0,0,2],[0,2,2]]
                ],
                faces: [
                    [[0,0,0], [1,0,0], [1,2,0], [0,2,0]], [[0,0,2], [1,0,2], [1,2,2], [0,2,2]],
                    [[0,0,0], [0,0,2], [0,2,2], [0,2,0]], [[1,0,0], [1,0,2], [1,2,2], [1,2,0]],
                    [[0,0,0], [1,0,0], [1,0,2], [0,0,2]], [[0,2,0], [1,2,0], [1,2,2], [0,2,2]]
                ]
            },
            quader_2x1x1: {
                name: "Quader 2×1×1",
                edges: [
                    [[0,0,0],[2,0,0]], [[2,0,0],[2,0,1]], [[2,0,1],[0,0,1]], [[0,0,1],[0,0,0]],
                    [[0,1,0],[2,1,0]], [[2,1,0],[2,1,1]], [[2,1,1],[0,1,1]], [[0,1,1],[0,1,0]],
                    [[0,0,0],[0,1,0]], [[2,0,0],[2,1,0]], [[2,0,1],[2,1,1]], [[0,0,1],[0,1,1]]
                ],
                faces: [
                    [[0,0,0], [2,0,0], [2,1,0], [0,1,0]], [[0,0,1], [2,0,1], [2,1,1], [0,1,1]],
                    [[0,0,0], [0,0,1], [0,1,1], [0,1,0]], [[2,0,0], [2,0,1], [2,1,1], [2,1,0]],
                    [[0,0,0], [2,0,0], [2,0,1], [0,0,1]], [[0,1,0], [2,1,0], [2,1,1], [0,1,1]]
                ]
            },
            quader_1x2x1: {
                name: "Quader 1×2×1",
                edges: [
                    [[0,0,0],[1,0,0]], [[1,0,0],[1,0,1]], [[1,0,1],[0,0,1]], [[0,0,1],[0,0,0]],
                    [[0,2,0],[1,2,0]], [[1,2,0],[1,2,1]], [[1,2,1],[0,2,1]], [[0,2,1],[0,2,0]],
                    [[0,0,0],[0,2,0]], [[1,0,0],[1,2,0]], [[1,0,1],[1,2,1]], [[0,0,1],[0,2,1]]
                ],
                faces: [
                    [[0,0,0], [1,0,0], [1,2,0], [0,2,0]], [[0,0,1], [1,0,1], [1,2,1], [0,2,1]],
                    [[0,0,0], [0,0,1], [0,2,1], [0,2,0]], [[1,0,0], [1,0,1], [1,2,1], [1,2,0]],
                    [[0,0,0], [1,0,0], [1,0,1], [0,0,1]], [[0,2,0], [1,2,0], [1,2,1], [0,2,1]]
                ]
            },
            quader_1x1x2: {
                name: "Quader 1×1×2",
                edges: [
                    [[0,0,0],[1,0,0]], [[1,0,0],[1,0,2]], [[1,0,2],[0,0,2]], [[0,0,2],[0,0,0]],
                    [[0,1,0],[1,1,0]], [[1,1,0],[1,1,2]], [[1,1,2],[0,1,2]], [[0,1,2],[0,1,0]],
                    [[0,0,0],[0,1,0]], [[1,0,0],[1,1,0]], [[1,0,2],[1,1,2]], [[0,0,2],[0,1,2]]
                ],
                faces: [
                    [[0,0,0], [1,0,0], [1,1,0], [0,1,0]], [[0,0,2], [1,0,2], [1,1,2], [0,1,2]],
                    [[0,0,0], [0,0,2], [0,1,2], [0,1,0]], [[1,0,0], [1,0,2], [1,1,2], [1,1,0]],
                    [[0,0,0], [1,0,0], [1,0,2], [0,0,2]], [[0,1,0], [1,1,0], [1,1,2], [0,1,2]]
                ]
            },
            quader_1x1x2_oben: {
                name: "Quader 1×1×2",
                edges: [
                    [[1,1,0],[2,1,0]], [[2,1,0],[2,1,2]], [[2,1,2],[1,1,2]], [[1,1,2],[1,1,0]],
                    [[1,2,0],[2,2,0]], [[2,2,0],[2,2,2]], [[2,2,2],[1,2,2]], [[1,2,2],[1,2,0]],
                    [[1,1,0],[1,2,0]], [[2,1,0],[2,2,0]], [[2,1,2],[2,2,2]], [[1,1,2],[1,2,2]]
                ],
                faces: [
                    [[1,1,0], [2,1,0], [2,2,0], [1,2,0]], [[1,1,2], [2,1,2], [2,2,2], [1,2,2]],
                    [[1,1,0], [1,1,2], [1,2,2], [1,2,0]], [[2,1,0], [2,1,2], [2,2,2], [2,2,0]],
                    [[1,1,0], [2,1,0], [2,1,2], [1,1,2]], [[1,2,0], [2,2,0], [2,2,2], [1,2,2]]
                ]
            },
            
            // ==================== DREIECKSPRISMEN ====================
            prisma_dreieck_RW_stehend: {
                name: "Dreiecksprisma",
                edges: [
                    [[0,0,0],[0,2,0]], [[0,2,0],[0,0,2]], [[0,0,2],[0,0,0]],
                    [[2,0,0],[2,2,0]], [[2,2,0],[2,0,2]], [[2,0,2],[2,0,0]],
                    [[0,0,0],[2,0,0]], [[0,2,0],[2,2,0]], [[0,0,2],[2,0,2]]
                ],
                faces: [
                    [[0,0,0], [0,2,0], [0,0,2]], [[2,0,0], [2,2,0], [2,0,2]],
                    [[0,0,0], [2,0,0], [2,2,0], [0,2,0]], [[0,2,0], [2,2,0], [2,0,2], [0,0,2]],
                    [[0,0,0], [0,0,2], [2,0,2], [2,0,0]]
                ]
            },
            prisma_dreieck_GS_stehend: {
                name: "Dreiecksprisma",
                edges: [
                    [[0,0,0],[2,0,0]], [[2,0,0],[1,0,2]], [[1,0,2],[0,0,0]],
                    [[0,2,0],[2,2,0]], [[2,2,0],[1,2,2]], [[1,2,2],[0,2,0]],
                    [[0,0,0],[0,2,0]], [[2,0,0],[2,2,0]], [[1,0,2],[1,2,2]]
                ],
                faces: [
                    [[0,0,0], [2,0,0], [1,0,2]], [[0,2,0], [2,2,0], [1,2,2]],
                    [[0,0,0], [0,2,0], [2,2,0], [2,0,0]], [[2,0,0], [2,2,0], [1,2,2], [1,0,2]],
                    [[0,0,0], [1,0,2], [1,2,2], [0,2,0]]
                ]
            },
            prisma_dreieck_liegend_z: {
                name: "Dreiecksprisma",
                edges: [
                    [[0,0,0],[2,0,0]], [[2,0,0],[2,2,0]], [[2,2,0],[0,0,0]],
                    [[0,0,2],[2,0,2]], [[2,0,2],[2,2,2]], [[2,2,2],[0,0,2]],
                    [[0,0,0],[0,0,2]], [[2,0,0],[2,0,2]], [[2,2,0],[2,2,2]]
                ],
                faces: [
                    [[0,0,0], [2,0,0], [2,2,0]], [[0,0,2], [2,0,2], [2,2,2]],
                    [[0,0,0], [0,0,2], [2,0,2], [2,0,0]], [[2,0,0], [2,0,2], [2,2,2], [2,2,0]],
                    [[0,0,0], [2,2,0], [2,2,2], [0,0,2]]
                ]
            },
            prisma_dreieck_liegend_y: {
                name: "Dreiecksprisma",
                edges: [
                    [[0,0,0],[2,0,0]], [[2,0,0],[2,0,2]], [[2,0,2],[0,0,0]],
                    [[0,1,0],[2,1,0]], [[2,1,0],[2,1,2]], [[2,1,2],[0,1,0]],
                    [[0,0,0],[0,1,0]], [[2,0,0],[2,1,0]], [[2,0,2],[2,1,2]]
                ],
                faces: [
                    [[0,0,0], [2,0,0], [2,0,2]], [[0,1,0], [2,1,0], [2,1,2]],
                    [[0,0,0], [0,1,0], [2,1,0], [2,0,0]], [[2,0,0], [2,1,0], [2,1,2], [2,0,2]],
                    [[0,0,0], [2,0,2], [2,1,2], [0,1,0]]
                ]
            },
            prisma_dreieck_klein: {
                name: "Dreiecksprisma",
                edges: [
                    [[0,0,0],[0,1,0]], [[0,1,0],[0,0,1]], [[0,0,1],[0,0,0]],
                    [[1,0,0],[1,1,0]], [[1,1,0],[1,0,1]], [[1,0,1],[1,0,0]],
                    [[0,0,0],[1,0,0]], [[0,1,0],[1,1,0]], [[0
